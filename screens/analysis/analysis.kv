#:kivy 2.0.0

<Analysis>:
    name: 'analysis'

    BoxLayout:
        orientation: "vertical"

        MDLabel:
            size_hint_y: None
            text: "Analysis"
            halign: "center"
            font_style: "H4"
            height: self.texture_size[1]
            padding: 0, dp(15)

        AnchorLayout:
            size_hint_y: None
            height: info_card.height
            padding: dp(20), 0

            MDCard:
                id: info_card
                size_hint: 1, None
                height: self.minimum_height
                md_bg_color: app.theme_cls.bg_dark
                orientation: "vertical"
                size_hint_max_x: dp(1000)
                elevation: 1
                spacing: dp(10)
                padding: dp(10)

                MDLabel:
                    size_hint_y: None
                    text: "ID: " + root._student_id
                    height: self.texture_size[1]

                MDLabel:
                    size_hint_y: None
                    text: "Name: " + root._fullname
                    height: self.texture_size[1]
                
                MDLabel:
                    size_hint_y: None
                    text: "Class: " + root._std_div
                    height: self.texture_size[1]

        AnchorLayout:
            size_hint_y: None
            height: year_box.height
            padding: dp(20), 0

            MDBoxLayout:
                id: year_box
                padding: 0, dp(20)
                adaptive_height: True
                spacing: dp(10)
                size_hint_max_x: dp(1000)

                Label:
                    text: "Year: "
                    size_hint: None, None
                    text_size: None, None
                    font_size: sp(18)
                    size: self.texture_size
                    pos_hint: {"center_x": 0.5, "center_y": 0.5}
                    color: "#434343"

                MDDropDownItem:
                    id: year
                    text: "2005"
                    size_hint: None, None
                    width: dp(80)
                    on_release: root.yearmenu.open()

        AnchorLayout:

            ScrollView:
                id: scrollview
                effect_cls: ScrollEffect
                scroll_type: ["bars"]
                smooth_scroll_end: 10
                bar_width: 10
                bar_inactive_color: .7, .7, .7, .3
                size_hint_max_x: dp(1000)

                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: self.minimum_height

                    AnchorLayout:
                        id: datatable_wrapper
                        size_hint_y: None
                        height: dp(360)
                        padding: dp(20), 0
                    
                    MDLabel:
                        adaptive_height: True
                        text: root.resname + " â€” " + root.resvalue
                        padding: 0, dp(20)
                        halign: "center"
                        font_style: "Subtitle1"

                    MDStackLayout:
                        id: button_box
                        adaptive_height: True
                        spacing: dp(20)
                        padding: dp(20), 0

                        MDRoundFlatButton:
                            text: "Get total average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "Total Average"
                                root.resvalue = str(round(root.marks.mean().mean(), 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get unit 1 average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "Unit1 Average"
                                root.resvalue = str(round(root.marks.mean().unit1, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get term 1 average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "Term1 Average"
                                root.resvalue = str(round(root.marks.mean().term1, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get unit 2 average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "Unit2 Average"
                                root.resvalue = str(round(root.marks.mean().unit2, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get term 2 average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "Term2 Average"
                                root.resvalue = str(round(root.marks.mean().term2, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get maths average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "Maths Average"
                                root.resvalue = str(round(root.marks.mean(1).Maths, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get English average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "English Average"
                                root.resvalue = str(round(root.marks.mean(1).English, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get Physics average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "Physics Average"
                                root.resvalue = str(round(root.marks.mean(1).Physics, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get Chemistry average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "Chemistry Average"
                                root.resvalue = str(round(root.marks.mean(1).Chemistry, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get IP average percentage"
                            line_width: 1.069
                            on_release:
                                root.resname = "IP Average"
                                root.resvalue = str(round(root.marks.mean(1).IP, 2)) + " %"

                        MDRoundFlatButton:
                            text: "Get overall student grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Overall student grade"
                                root.resvalue = root.get_grade(root.marks.mean().mean())

                        MDRoundFlatButton:
                            text: "Get unit 1 student grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Unit 1 student grade"
                                root.resvalue = root.get_grade(root.marks.mean().unit1)

                        MDRoundFlatButton:
                            text: "Get term 1 student grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Term 1 student grade"
                                root.resvalue = root.get_grade(root.marks.mean().term1)

                        MDRoundFlatButton:
                            text: "Get unit 2 student grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Unit 2 student grade"
                                root.resvalue = root.get_grade(root.marks.mean().unit2)

                        MDRoundFlatButton:
                            text: "Get term 2 student grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Term 2 student grade"
                                root.resvalue = root.get_grade(root.marks.mean().term2)
                        
                        MDRoundFlatButton:
                            text: "Get overall class grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Overall class grade"
                                root.resvalue = root._class_grades.get("overall", "NA")

                        MDRoundFlatButton:
                            text: "Get unit 1 class grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Unit 1 class grade"
                                root.resvalue = root._class_grades.get("unit1", "NA")

                        MDRoundFlatButton:
                            text: "Get term 1 class grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Term 1 class grade"
                                root.resvalue = root._class_grades.get("term1", "NA")

                        MDRoundFlatButton:
                            text: "Get unit 2 class grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Unit 2 class grade"
                                root.resvalue = root._class_grades.get("unit2", "NA")

                        MDRoundFlatButton:
                            text: "Get term 2 class grade"
                            line_width: 1.069
                            on_release:
                                root.resname = "Term 2 class grade"
                                root.resvalue = root._class_grades.get("term2", "NA")
